# How to Test Sprint X Automatic Minting Flow

**Testing URL**: https://nuru.network/sippar/
**Backend**: ‚úÖ **DEPLOYED** with Sprint X fixes + deposit detection + real transaction ID support (Sept 16, 2025)
**Frontend**: ‚úÖ **UPDATED** with automatic monitoring system + existing balance minting option
**Status**: üéâ **SPRINT X FRONTEND FIX COMPLETE** - "Mint from Existing Balance" option added

## ‚ö†Ô∏è **IMPORTANT: Sprint X Changes**
- **No Manual Minting**: System is now fully automatic (no "mint" buttons to click)
- **Real Addresses**: Sprint X generates authentic threshold-controlled custody addresses
- **Extended Time**: Allow 5-15 minutes for automatic processing (vs previous 1-2 minutes)
- **Balance Monitoring**: Frontend detects completion by checking ckALGO balance increases
- **üîß CRITICAL FIX (Sept 16, 2025)**: Deposit detection service now properly registers custody addresses generated by frontend
- **üí∞ NEW FEATURE (Sept 16, 2025)**: Frontend now shows "Use Existing Balance" option when ALGO is already in custody address

---

## üß™ **Testing Options**

### **Option 1: Full End-to-End Test (Recommended)**
**Best for**: Verifying complete user experience with real ALGO

#### **Frontend User Testing Steps (Post-Sprint X Fixes)**:

**Step 1: Access & Authentication**
1. **Open Browser**: Navigate to https://nuru.network/sippar/
2. **Clear Cache**: Press `Ctrl+Shift+R` (Windows) or `Cmd+Shift+R` (Mac) to ensure latest Sprint X frontend
3. **Login**: Click the **"Connect Internet Identity"** button (blue button in top right)
4. **Authenticate**: Complete Internet Identity login process
5. **Verify Login**: Confirm you see your Principal ID displayed (may show truncated like `7resf-5veak-mtapl-...-3ae` - this is normal UI behavior)

**Step 2: Navigate to Minting**
6. **Find Mint Section**: Click on the **"Mint"** tab/button in the main interface
7. **Verify Sprint X UI**: You should see the mint interface with amount input field
8. **Check Console**: Open browser Developer Tools (F12) to monitor Sprint X logs

**Step 3: Generate Custody Address (Sprint X)**
9. **Enter Amount**: Type your desired amount in ALGO (minimum 0.1 ALGO)
   - **Test Amount**: Start with `0.1` ALGO for testing
   - Interface should show equivalent in microALGO (100000)
10. **Click Prepare**: Click **"Prepare Mint"** or **"Generate Custody Address"** button
11. **Wait for Real Address**: System will generate your **unique threshold-controlled custody address**
    - ‚è±Ô∏è **Generation Time**: Should take 2-5 seconds
    - üîç **Console Check**: Look for "‚úÖ Mint preparation successful" in browser console

**Step 4: Verify Real Custody Address (Sprint X)**
12. **Find Generated Address**: Look for the custody address display area
    - ‚úÖ **Real Sprint X Address**: Should be a 58-character Algorand address (e.g., `6W47GCLXWEIEZ2LRQCXF7HGLOYSXYCXOPXJ5YE55EULFHB7O4RWIM3JDCI`)
    - ‚ùå **No Simulation Data**: Should NOT show `SIMULATED_CUSTODY_ADDRESS_1` or placeholder text
    - üîç **Console Verification**: Check for "üè¶ Custody address: [REAL_ADDRESS]" in browser console
13. **Copy Complete Address**: Click the **copy button** or manually select and copy the **full 58-character address**
14. **Address Validation**:
    - Should start with uppercase letters (A-Z, 2-7)
    - Should be exactly 58 characters long
    - Same address will be reused for this user (Sprint X doesn't generate new address per transaction)

**Step 5: Send ALGO from Your Wallet (Critical Step)**
15. **Open Algorand Wallet**: Use Pera Wallet, MyAlgo, or any Algorand wallet
16. **Create New Transaction**: Start a new ALGO transfer
17. **Paste Custody Address**: Paste the EXACT custody address from Step 4 as recipient
18. **Enter EXACT Amount**: Send precisely the amount you specified (e.g., `0.1` ALGO)
    - ‚ö†Ô∏è **Must Match**: Amount must exactly match what you entered in the interface
    - üí∞ **Include Fees**: Ensure wallet has extra ALGO for transaction fees (~0.001 ALGO)
19. **Send Transaction**: Confirm and broadcast the transaction
20. **Copy Transaction ID**: Copy the Algorand transaction ID for reference (optional but helpful for debugging)

**Step 6: Monitor Sprint X Automatic Processing (KEY TEST)**
21. **Return to Frontend**: Go back to the Sippar interface immediately after sending transaction
22. **Observe Sprint X Monitoring**: Look for the following progression:
    - üîÑ **"Monitoring for Deposit"** message with spinner
    - üìä **Progress Indicators**: Should show Sprint X automatic system status
    - ‚è±Ô∏è **Time Estimates**: Should display remaining time (up to 15 minutes)
23. **Sprint X Status Messages**: Watch for these specific displays:
    - **Stage 1**: "Waiting for confirmations" (first 2-5 minutes)
    - **Stage 2**: "Monitoring automatic minting" (after confirmations)
    - **Final**: "‚úÖ Automatic minting completed successfully!"
24. **Console Monitoring**: Check browser console for Sprint X logs:
    - "üöÄ Sprint X: Starting automatic minting monitoring"
    - "üîç Sprint X monitoring attempt X/90"
    - "‚úÖ Sprint X: ckALGO balance detected - automatic minting likely completed!"
25. **No Manual Action**: ‚ùå **CRITICAL** - Do NOT click any "Mint" buttons - Sprint X is 100% automatic

**Step 7: Verify Sprint X Completion (Authentic Mathematical Backing)**
26. **Wait for Completion**: System should complete automatically within 5-15 minutes
    - ‚è≥ **Normal Time**: 5-10 minutes typical
    - üïê **Maximum Time**: Up to 15 minutes for busy networks
27. **Check Dashboard**: Click the **"Dashboard"** tab to view your balances
28. **Verify ckALGO Balance**: Confirm your ckALGO balance increased by the **exact deposited amount**
    - ‚úÖ **Sprint X Authentic**: Shows real 1:1 mathematical backing (not simulation)
    - üî¢ **Exact Match**: Balance should exactly match your ALGO deposit
    - üí∞ **Example**: Deposited 0.1 ALGO ‚Üí Should see 0.1 ckALGO (or 100000 microALGO)
29. **Success Verification**: Look for completion indicators:
    - ‚úÖ Green success message in frontend
    - üéâ Console log: "‚úÖ Sprint X: ckALGO balance detected"
    - üìä Dashboard shows updated balance

**Expected Behavior**:
- ‚úÖ Custody address generated: `6W47GCLXWEIEZ2LRQCXF...` (real threshold control)
- ‚úÖ Frontend shows "Monitoring for Deposit" with real-time status
- ‚úÖ After 6 confirmations (mainnet), **automatic minting** happens
- ‚úÖ User receives ckALGO without manual action
- ‚úÖ Dashboard updates with new ckALGO balance

### **Option 2: Backend API Testing**
**Best for**: Technical verification without spending ALGO

#### **Test Commands**:
```bash
# 1. Check system health
curl "https://nuru.network/api/sippar/health"

# 2. Generate custody address (requires valid Principal)
curl -X POST "https://nuru.network/api/sippar/api/v1/sippar/mint/prepare" \
  -H "Content-Type: application/json" \
  -d '{"user_principal": "YOUR_PRINCIPAL", "amount": 1000000}'

# 3. Check balance (uses real canister)
curl "https://nuru.network/api/sippar/ck-algo/balance/YOUR_PRINCIPAL"

# 4. Test automatic minting endpoint (will fail with test data - that's expected)
curl -X POST "https://nuru.network/api/sippar/ck-algo/mint-confirmed-deposit" \
  -H "Content-Type: application/json" \
  -d '{"principal": "YOUR_PRINCIPAL", "txId": "TEST_TX_ID"}'
```

### **Option 3: Monitoring Verification**
**Best for**: Confirming the automatic system is active

#### **Check System Status**:
```bash
# Backend deployment time (should be recent)
curl -s "https://nuru.network/api/sippar/health" | jq '.timestamp'

# System components (should all be true)
curl -s "https://nuru.network/api/sippar/health" | jq '.components'

# Reserve status (should show 0 supply - authentic data)
curl -s "https://nuru.network/api/sippar/reserves/status" | jq '.data'
```

---

## üéØ **What to Look For**

### **Frontend Behavior**
- ‚úÖ **Custody Address**: Should show real address starting with `6W47GCLXWEIEZ2LRQCXF...`
- ‚úÖ **Monitoring UI**: Shows "Monitoring for Deposit" with spinner and timer
- ‚úÖ **Automatic Processing**: No manual "mint" button required after deposit
- ‚úÖ **Success Message**: Shows "ckALGO tokens minted successfully" automatically
- ‚úÖ **Balance Update**: Dashboard refreshes with new ckALGO balance

### **Backend Logs** (if you have access)
Look for these log messages indicating automatic minting:
```
üéâ Handling confirmed deposit: [TX_ID] for [AMOUNT] ALGO
üîÑ Automatically minting ckALGO for confirmed deposit [TX_ID]
‚úÖ Successfully auto-minted [AMOUNT] ckALGO for deposit [TX_ID]
üéâ AUTOMATIC MINTING COMPLETE: [AMOUNT] ckALGO minted for user [PRINCIPAL]
```

### **Key Differences from Before**

| Aspect | Before (Semi-Automatic) | After (Fully Automatic) |
|--------|------------------------|-------------------------|
| **Deposit Detection** | ‚úÖ Working | ‚úÖ Working |
| **Confirmation** | ‚úÖ Working | ‚úÖ Working |
| **Minting Trigger** | ‚ùå Manual API call needed | ‚úÖ **Automatic** |
| **User Action** | Must call minting endpoint | **None required** |
| **Experience** | Confusing (wait then act) | **Seamless** |

---

## üîç **Testing Scenarios**

### **Scenario 1: Happy Path Test (Detailed Frontend Flow)**
1. **Login**: Click "Connect Internet Identity" ‚Üí Complete authentication ‚Üí See Principal ID
2. **Navigate**: Click "Mint" tab ‚Üí See amount input field
3. **Prepare**: Enter "0.5" ‚Üí Click "Prepare Mint" ‚Üí Copy generated custody address `6W47GCLXWEIEZ2LRQCXF...`
4. **Send**: Open Algorand wallet ‚Üí Send exactly 0.5 ALGO to custody address ‚Üí Confirm transaction
5. **Monitor**: Return to frontend ‚Üí See "Monitoring for Deposit" spinner ‚Üí Wait 3-5 minutes
6. **Verify**: Click "Dashboard" ‚Üí Confirm ckALGO balance increased by 0.5 ‚Üí See success notification

**Expected Result**: ‚úÖ Seamless automatic experience with no manual minting button needed

### **Scenario 2: Error Handling Test (Frontend Validation)**
1. **Setup**: Login ‚Üí Navigate to Mint ‚Üí Enter "0.5" ‚Üí Generate custody address
2. **Wrong Amount**: Send 0.05 ALGO (wrong amount) to custody address from wallet
3. **Monitor**: Return to frontend ‚Üí Watch for error handling in monitoring UI
4. **Verify**: Check that system shows appropriate error, funds remain safe

**Expected Result**: ‚úÖ Clear error message in frontend, no loss of funds, monitoring shows status

### **Scenario 3: Multiple Users Test (Frontend Isolation)**
1. **User 1**: Login with Internet Identity A ‚Üí Generate address ‚Üí Note unique address
2. **User 2**: Login with Internet Identity B ‚Üí Generate address ‚Üí Verify different address
3. **Parallel Test**: Both users send ALGO to their respective addresses simultaneously
4. **Verify Isolation**: Each user's Dashboard shows only their own ckALGO balance

**Expected Result**: ‚úÖ Isolated automatic processing per user, unique addresses, separate balances

---

## üìä **Verification Checklist**

### **Pre-Test Setup**
- [ ] Internet Identity account ready
- [ ] Algorand wallet with some ALGO for testing
- [ ] Browser console open to see detailed logs
- [ ] Network set to mainnet (for real testing) or testnet

### **During Test - Step-by-Step Checklist**
- [ ] **Step 1-4**: Login successful, Principal ID visible
- [ ] **Step 5-6**: Mint tab accessible, amount input working
- [ ] **Step 7-9**: Amount entered, prepare mint button clicked, address generation started
- [ ] **Step 10-12**: Custody address displayed starting with `6W47GCLXWEIEZ2LRQCXF...`
- [ ] **Step 13-17**: Address copied, wallet opened, exact amount sent to custody address
- [ ] **Step 18-21**: Frontend shows "Monitoring for Deposit" with active spinner
- [ ] **Step 22-24**: No manual buttons clicked, automatic processing occurs within 3-10 minutes

### **Post-Test Validation**
- [ ] ckALGO balance increased correctly
- [ ] Dashboard updated automatically
- [ ] No error messages in console
- [ ] Transaction visible on Algorand explorer
- [ ] System ready for next user/test

---

## üöÄ **Advanced Testing**

### **High-Volume Simulation**
Test multiple deposits in sequence to verify:
- Each deposit processed automatically
- No interference between deposits
- System scales properly

### **Network Condition Testing**
- Test on different networks (mainnet vs testnet)
- Verify confirmation thresholds (6 mainnet, 3 testnet)
- Test with slow network conditions

### **Edge Case Testing**
- Minimum deposit amounts (0.1 ALGO)
- Maximum deposit amounts
- Duplicate deposits to same address
- Deposits from multiple sources to same custody address

---

## üí° **Troubleshooting Guide**

### **If Automatic Minting Doesn't Happen (Sprint X Troubleshooting)**
1. **Check Real Deposit**: Verify ALGO transaction **confirmed on Algorand blockchain** (use explorer)
2. **Check Exact Amount**: Ensure deposit **exactly matches** requested amount (Sprint X is strict)
3. **Check Custody Address**: Confirm you sent to the **correct threshold address** (not simulation)
4. **Wait Full Time**: Allow 5-10 minutes for confirmations + Sprint X processing
5. **Check Browser Console**: Look for Sprint X-specific error messages
6. **Verify Sprint X Integration**: Backend should show authentic mathematical backing

### **Sprint X Specific Issues (Post-Fixes)**

#### **If You See Old Error Messages**:
- **"Minting requires real ALGO deposit"**: Backend not updated - should now show Sprint X workflow guidance
- **Solution**: Refresh page or try again - backend was updated Sept 16, 2025

#### **If Frontend Shows Errors**:
- **"Manual minting disabled"**: ‚úÖ **Correct behavior** - Sprint X is automatic only
- **Missing progress indicators**: Clear browser cache (`Ctrl+Shift+R` or `Cmd+Shift+R`)
- **Console errors**: Check for network connectivity issues

#### **If Automatic Minting Doesn't Complete**:
1. **Check Transaction**: Verify your ALGO transaction confirmed on Algorand blockchain
2. **Amount Mismatch**: Ensure exact amount match between interface and wallet transaction
3. **Wait Longer**: Sprint X needs 5-15 minutes (extended from old 1-2 minute timeouts)
4. **Console Check**: Look for Sprint X monitoring logs - should see attempts 1-90
5. **Network Issues**: Try refreshing page if no console activity after 5 minutes

#### **Expected vs Problem Behaviors**:
| ‚úÖ **Expected (Sprint X)** | ‚ùå **Problem (Old System)** |
|---------------------------|----------------------------|
| Real 58-char custody address | `SIMULATED_CUSTODY_ADDRESS_1` |
| "Sprint X automatic system" status | "Minting requires real deposit" error |
| Balance monitoring for 5-15 min | 1-2 minute timeout |
| Console: "Sprint X monitoring" | Console: Manual minting calls |

### **Common Issues**
- **Wrong Network**: Ensure using correct network (mainnet/testnet)
- **Insufficient ALGO**: Need minimum 0.1 ALGO plus transaction fees
- **Browser Issues**: Try refreshing page or different browser
- **Network Delays**: Algorand network may be slow during high usage

---

## üéØ **Testing Success Criteria**

### **Functional Success**
- ‚úÖ User deposits ALGO and automatically receives ckALGO
- ‚úÖ No manual intervention required
- ‚úÖ Process completes within reasonable time (3-10 minutes)
- ‚úÖ Balance updates correctly

### **UX Success**
- ‚úÖ Clear progress indication during monitoring
- ‚úÖ Automatic completion without user confusion
- ‚úÖ Helpful error messages if something goes wrong
- ‚úÖ Seamless integration with existing UI

### **Technical Success**
- ‚úÖ Real threshold-controlled custody addresses
- ‚úÖ Authentic mathematical 1:1 backing maintained
- ‚úÖ Automatic system with manual fallback
- ‚úÖ Production-grade error handling and logging

---

---

## ‚úÖ **Sprint X Testing Checklist**

### **Pre-Test Setup**
- [ ] Browser cache cleared (`Ctrl+Shift+R` or `Cmd+Shift+R`)
- [ ] Developer Tools open (F12) for console monitoring
- [ ] Algorand wallet ready with 0.2+ ALGO (for test + fees)
- [ ] Internet Identity account ready

### **During Test - Step Verification**
- [ ] **Authentication**: Principal ID displayed (truncated is normal)
- [ ] **Address Generation**: Real 58-character custody address (not simulation)
- [ ] **Console Logs**: "‚úÖ Mint preparation successful" appears
- [ ] **Transaction**: Exact amount sent to exact custody address
- [ ] **Sprint X Monitoring**: Progress indicators and time estimates shown
- [ ] **No Manual Action**: Resisted clicking any "mint" buttons
- [ ] **Console Monitoring**: Sprint X monitoring attempts logged (1-90)
- [ ] **Completion**: Balance increased by exact deposit amount
- [ ] **Success Message**: Green completion notification appeared

### **Success Criteria**
- ‚úÖ **Address**: Real threshold-controlled custody address generated
- ‚úÖ **Monitoring**: Sprint X automatic system displays progress
- ‚úÖ **Time**: Process completes within 5-15 minutes
- ‚úÖ **Balance**: ckALGO balance matches ALGO deposit exactly
- ‚úÖ **Authentic**: No simulation data or placeholder values
- ‚úÖ **Console**: Clean Sprint X monitoring logs without errors

### **If Issues Occur**
1. **Screenshot** the error for debugging
2. **Copy console logs** showing Sprint X attempts
3. **Note timing** - how long before timeout/error
4. **Check transaction** on Algorand explorer
5. **Verify amounts** match between interface and wallet

---

**Testing Status**: üéâ **SPRINT X FIXES DEPLOYED & READY**
**System**: Automatic minting with authentic mathematical backing
**Access**: https://nuru.network/sippar/ (Internet Identity required)
**Backend**: Updated Sept 16, 2025 with Sprint X error message improvements
**Frontend**: Updated with automatic monitoring and extended timeouts

**Ready for Sprint X Testing!** üöÄ