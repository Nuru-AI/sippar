<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X402 SDK Live Demo</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .demo-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }

        .demo-section:last-child {
            border-bottom: none;
        }

        .demo-section h2 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
            background: #f8f9ff;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .success {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .error {
            border-left-color: #dc3545;
            background: #fff8f8;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2a5298;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .service-list {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .service-item {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .service-item:last-child {
            border-bottom: none;
        }

        .service-name {
            font-weight: bold;
            color: #2a5298;
        }

        .service-price {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ X402 SDK Demo (SIMULATION)</h1>
            <p><strong>‚ö†Ô∏è THIS IS A DEMONSTRATION ONLY</strong></p>
            <p>This demo simulates the X402 payment protocol. For the real system, visit <a href="https://nuru.network/sippar/" style="color: #ffeb3b; text-decoration: underline;">https://nuru.network/sippar/</a></p>
        </div>

        <!-- Configuration Section -->
        <div class="demo-section">
            <h2>‚öôÔ∏è Configuration</h2>
            <div class="two-column">
                <div>
                    <div class="form-group">
                        <label for="principal">Internet Identity Principal</label>
                        <input type="text" id="principal" placeholder="7renf-5svak-mtapl-juxhw-3hv7d-zzfzs-hjlxv-p7wsv-e2zjc-kksxf-3ae">
                    </div>
                    <div class="form-group">
                        <label for="algorandAddress">Algorand Address</label>
                        <input type="text" id="algorandAddress" placeholder="6W47GCLXWEIEZ2LRQCXF7HGLOYSXYCXOPXJ5YE55EULFHB7O4RWIM3JDCI">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label for="baseURL">API Base URL</label>
                        <input type="text" id="baseURL" value="https://nuru.network/api/sippar">
                    </div>
                    <div class="form-group">
                        <label for="apiKey">Enterprise API Key (Optional)</label>
                        <input type="password" id="apiKey" placeholder="Enter your enterprise API key">
                    </div>
                </div>
            </div>
            <button class="btn" onclick="initializeClient()">Initialize X402 Client</button>
            <div id="initResult"></div>
        </div>

        <!-- Service Discovery Section -->
        <div class="demo-section">
            <h2>üõí Service Discovery</h2>
            <p>Discover available AI services in the X402 marketplace</p>
            <button class="btn" onclick="discoverServices()" id="discoverBtn">Discover Services</button>
            <div id="servicesResult"></div>
        </div>

        <!-- Payment Creation Section -->
        <div class="demo-section">
            <h2>üí≥ Payment Creation</h2>
            <div class="two-column">
                <div>
                    <div class="form-group">
                        <label for="service">Service</label>
                        <select id="service">
                            <option value="ai-oracle-basic">AI Oracle Basic ($0.01)</option>
                            <option value="ai-oracle-enhanced">AI Oracle Enhanced ($0.05)</option>
                            <option value="market-analysis">Market Analysis ($0.03)</option>
                            <option value="enterprise-ai">Enterprise AI ($0.10)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount (USD)</label>
                        <input type="number" id="amount" value="0.05" min="0.01" max="100" step="0.01">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label for="metadata">Metadata (JSON, Optional)</label>
                        <textarea id="metadata" placeholder='{"userId": "demo", "environment": "test"}'></textarea>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="createPayment()" id="paymentBtn">Create Payment</button>
            <div id="paymentResult"></div>
        </div>

        <!-- AI Service Usage Section -->
        <div class="demo-section">
            <h2>ü§ñ AI Service Usage</h2>
            <div class="two-column">
                <div>
                    <div class="form-group">
                        <label for="query">AI Query</label>
                        <textarea id="query" placeholder="Ask the AI anything...">What are the benefits of blockchain technology for autonomous AI agents?</textarea>
                    </div>
                    <div class="form-group">
                        <label for="model">AI Model</label>
                        <select id="model">
                            <option value="deepseek-r1">DeepSeek-R1 (Advanced Reasoning)</option>
                            <option value="qwen2.5">Qwen2.5 (Language Model)</option>
                            <option value="phi-3">Phi-3 (Efficient Model)</option>
                            <option value="mistral">Mistral (Balanced Model)</option>
                        </select>
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label for="serviceToken">Service Token</label>
                        <input type="text" id="serviceToken" placeholder="Token from payment creation" readonly>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="explanation"> Request Explanation
                        </label>
                        <label>
                            <input type="checkbox" id="confidence"> Include Confidence Score
                        </label>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="queryAI()" id="aiBtn">Query AI Service</button>
            <div id="aiResult"></div>
        </div>

        <!-- Analytics Section -->
        <div class="demo-section">
            <h2>üìä Analytics & Monitoring</h2>
            <div class="two-column">
                <div>
                    <button class="btn" onclick="getAnalytics()" id="analyticsBtn">Get Analytics</button>
                    <div id="analyticsResult"></div>
                </div>
                <div>
                    <button class="btn" onclick="getPaymentStatus()" id="statusBtn">Check Payment Status</button>
                    <div id="statusResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global X402 client instance
        let x402Client = null;
        let currentPaymentId = null;

        // Mock X402Client for demo purposes
        class X402Client {
            constructor(config) {
                this.config = config;
                console.log('X402Client initialized with config:', config);
            }

            // Simulate API calls with realistic delays and responses
            async createPayment(request) {
                await this.delay(1000);

                const paymentId = 'payment_' + Date.now();
                const serviceToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.demo_token.' + Math.random().toString(36);

                currentPaymentId = paymentId;

                return {
                    success: true,
                    paymentId,
                    serviceToken,
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                    algorandIntegration: {
                        backingAddress: this.config.algorandAddress,
                        thresholdControlled: true,
                        canisterId: 'hldvt-2yaaa-aaaak-qulxa-cai',
                        mathematicalProof: 'verified_' + Math.random().toString(36)
                    }
                };
            }

            async getMarketplace() {
                await this.delay(800);

                return {
                    success: true,
                    marketplace: {
                        totalServices: 5,
                        algorand_integration: 'Active',
                        services: [
                            {
                                id: 'ai-oracle-basic',
                                name: 'AI Oracle Basic',
                                description: 'Basic AI processing with standard models',
                                price: 0.01,
                                endpoint: '/ai/query',
                                capabilities: ['text-generation', 'qa'],
                                algorand_features: {
                                    threshold_backed: true,
                                    address_derivation: true,
                                    smart_contract_integration: true
                                }
                            },
                            {
                                id: 'ai-oracle-enhanced',
                                name: 'AI Oracle Enhanced',
                                description: 'Advanced AI processing with reasoning capabilities',
                                price: 0.05,
                                endpoint: '/ai/enhanced-query',
                                capabilities: ['reasoning', 'explanation', 'analysis'],
                                algorand_features: {
                                    threshold_backed: true,
                                    address_derivation: true,
                                    smart_contract_integration: true
                                }
                            },
                            {
                                id: 'market-analysis',
                                name: 'Market Analysis',
                                description: 'Real-time cryptocurrency market analysis',
                                price: 0.03,
                                endpoint: '/market/analyze',
                                capabilities: ['market-data', 'trend-analysis'],
                                algorand_features: {
                                    threshold_backed: true,
                                    address_derivation: false,
                                    smart_contract_integration: true
                                }
                            }
                        ]
                    }
                };
            }

            async queryAI(request, token) {
                await this.delay(1200);

                const responses = {
                    'deepseek-r1': 'Blockchain technology offers autonomous AI agents several key benefits: 1) Trustless interactions through smart contracts, 2) Cryptographic security for data integrity, 3) Decentralized consensus for decision validation, 4) Programmable money for autonomous transactions, and 5) Immutable audit trails for accountability.',
                    'qwen2.5': 'Blockchain technology provides autonomous AI agents with secure, transparent, and programmable infrastructure for conducting business without human intervention.',
                    'phi-3': 'Blockchain enables AI agents to operate autonomously with cryptographic security, smart contracts, and decentralized trust.',
                    'mistral': 'The integration of blockchain with AI agents creates new possibilities for autonomous commerce, secure data sharing, and trustless cooperation.'
                };

                return {
                    success: true,
                    ai_response: responses[request.model] || responses['phi-3'],
                    confidence: 0.95,
                    model_used: request.model,
                    algorand_integration: {
                        user_address: this.config.algorandAddress,
                        threshold_controlled: true,
                        mathematical_backing: true,
                        canister_id: 'hldvt-2yaaa-aaaak-qulxa-cai'
                    }
                };
            }

            async getAnalytics() {
                await this.delay(900);

                return {
                    success: true,
                    analytics: {
                        metrics: {
                            totalPayments: 1247,
                            totalRevenue: 234.56,
                            averagePaymentAmount: 0.047,
                            successRate: 0.987
                        },
                        algorand_integration_metrics: {
                            threshold_signatures_used: 1205,
                            algorand_addresses_derived: 456,
                            successful_algo_transactions: 1189,
                            average_transaction_time: '1.2s',
                            network_success_rate: 0.994
                        },
                        service_usage: {
                            'ai-oracle-enhanced': { calls: 782, algorand_addresses: 234 },
                            'ai-oracle-basic': { calls: 465, algorand_addresses: 187 },
                            'market-analysis': { calls: 234, algorand_addresses: 89 }
                        }
                    }
                };
            }

            async getPaymentStatus(paymentId) {
                await this.delay(500);

                return {
                    paymentId,
                    status: 'completed',
                    amount: 0.05,
                    service: 'ai-oracle-enhanced',
                    createdAt: new Date(Date.now() - 60000).toISOString(),
                    updatedAt: new Date().toISOString(),
                    serviceToken: document.getElementById('serviceToken').value
                };
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading"><span class="spinner"></span>Processing...</div>';
        }

        function showResult(elementId, content, isError = false) {
            const className = isError ? 'result-box error' : 'result-box success';
            document.getElementById(elementId).innerHTML = `<div class="${className}">${content}</div>`;
        }

        function initializeClient() {
            const principal = document.getElementById('principal').value;
            const algorandAddress = document.getElementById('algorandAddress').value;
            const baseURL = document.getElementById('baseURL').value;
            const apiKey = document.getElementById('apiKey').value;

            if (!principal || !algorandAddress) {
                showResult('initResult', 'Error: Principal and Algorand address are required', true);
                return;
            }

            const config = {
                principal,
                algorandAddress,
                baseURL: baseURL || 'https://nuru.network/api/sippar'
            };

            if (apiKey) {
                config.apiKey = apiKey;
            }

            try {
                x402Client = new X402Client(config);
                showResult('initResult', `‚úÖ X402 Client initialized successfully!\n\nConfiguration:\nPrincipal: ${principal}\nAlgorand Address: ${algorandAddress}\nBase URL: ${config.baseURL}\nAPI Key: ${apiKey ? '***configured***' : 'not provided'}`);

                // Enable other buttons
                document.getElementById('discoverBtn').disabled = false;
                document.getElementById('paymentBtn').disabled = false;
                document.getElementById('aiBtn').disabled = false;
                document.getElementById('analyticsBtn').disabled = false;
                document.getElementById('statusBtn').disabled = false;
            } catch (error) {
                showResult('initResult', `Error: ${error.message}`, true);
            }
        }

        async function discoverServices() {
            if (!x402Client) {
                showResult('servicesResult', 'Error: Please initialize the client first', true);
                return;
            }

            showLoading('servicesResult');

            try {
                const marketplace = await x402Client.getMarketplace();

                let servicesHtml = `‚úÖ Marketplace Discovery Successful!\n\nTotal Services: ${marketplace.marketplace.totalServices}\nAlgorand Integration: ${marketplace.marketplace.algorand_integration}\n\nAvailable Services:\n`;

                marketplace.marketplace.services.forEach(service => {
                    servicesHtml += `\nüì¶ ${service.name} (${service.id})\n`;
                    servicesHtml += `   Price: $${service.price}\n`;
                    servicesHtml += `   Description: ${service.description}\n`;
                    servicesHtml += `   Endpoint: ${service.endpoint}\n`;
                    servicesHtml += `   Capabilities: ${service.capabilities.join(', ')}\n`;
                    if (service.algorand_features) {
                        servicesHtml += `   Threshold Backed: ${service.algorand_features.threshold_backed}\n`;
                    }
                    servicesHtml += '\n';
                });

                showResult('servicesResult', servicesHtml);
            } catch (error) {
                showResult('servicesResult', `Error: ${error.message}`, true);
            }
        }

        async function createPayment() {
            if (!x402Client) {
                showResult('paymentResult', 'Error: Please initialize the client first', true);
                return;
            }

            const service = document.getElementById('service').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const metadataText = document.getElementById('metadata').value;

            let metadata = {};
            if (metadataText) {
                try {
                    metadata = JSON.parse(metadataText);
                } catch (e) {
                    showResult('paymentResult', 'Error: Invalid JSON in metadata field', true);
                    return;
                }
            }

            showLoading('paymentResult');

            try {
                const payment = await x402Client.createPayment({
                    service,
                    amount,
                    metadata
                });

                // Auto-fill the service token
                document.getElementById('serviceToken').value = payment.serviceToken;

                showResult('paymentResult', `‚úÖ Payment Created Successfully!\n\nPayment ID: ${payment.paymentId}\nService Token: ${payment.serviceToken.substring(0, 50)}...\nExpires At: ${payment.expiresAt}\n\nAlgorand Integration:\nBacking Address: ${payment.algorandIntegration.backingAddress}\nThreshold Controlled: ${payment.algorandIntegration.thresholdControlled}\nCanister ID: ${payment.algorandIntegration.canisterId}\nMathematical Proof: ${payment.algorandIntegration.mathematicalProof}`);
            } catch (error) {
                showResult('paymentResult', `Error: ${error.message}`, true);
            }
        }

        async function queryAI() {
            if (!x402Client) {
                showResult('aiResult', 'Error: Please initialize the client first', true);
                return;
            }

            const query = document.getElementById('query').value;
            const model = document.getElementById('model').value;
            const serviceToken = document.getElementById('serviceToken').value;
            const explanation = document.getElementById('explanation').checked;
            const confidence = document.getElementById('confidence').checked;

            if (!query || !serviceToken) {
                showResult('aiResult', 'Error: Query and service token are required', true);
                return;
            }

            showLoading('aiResult');

            try {
                const request = {
                    query,
                    model,
                    options: {
                        explanation,
                        confidence_score: confidence
                    }
                };

                const response = await x402Client.queryAI(request, serviceToken);

                showResult('aiResult', `‚úÖ AI Service Response!\n\nQuery: "${query}"\nModel: ${response.model_used}\nConfidence: ${response.confidence ? (response.confidence * 100).toFixed(1) + '%' : 'N/A'}\n\nResponse:\n${response.ai_response}\n\nAlgorand Integration:\nUser Address: ${response.algorand_integration.user_address}\nThreshold Controlled: ${response.algorand_integration.threshold_controlled}\nMathematical Backing: ${response.algorand_integration.mathematical_backing}`);
            } catch (error) {
                showResult('aiResult', `Error: ${error.message}`, true);
            }
        }

        async function getAnalytics() {
            if (!x402Client) {
                showResult('analyticsResult', 'Error: Please initialize the client first', true);
                return;
            }

            showLoading('analyticsResult');

            try {
                const analytics = await x402Client.getAnalytics();
                const metrics = analytics.analytics.metrics;
                const algorand = analytics.analytics.algorand_integration_metrics;

                showResult('analyticsResult', `‚úÖ Analytics Retrieved!\n\nüìä Usage Metrics:\nTotal Payments: ${metrics.totalPayments}\nTotal Revenue: $${metrics.totalRevenue}\nAverage Payment: $${metrics.averagePaymentAmount}\nSuccess Rate: ${(metrics.successRate * 100).toFixed(1)}%\n\nüîó Algorand Integration:\nThreshold Signatures: ${algorand.threshold_signatures_used}\nAddresses Derived: ${algorand.algorand_addresses_derived}\nSuccessful Transactions: ${algorand.successful_algo_transactions}\nAverage Transaction Time: ${algorand.average_transaction_time}\nNetwork Success Rate: ${(algorand.network_success_rate * 100).toFixed(1)}%\n\nüéØ Service Usage:\n${Object.entries(analytics.analytics.service_usage).map(([service, data]) => `${service}: ${data.calls} calls`).join('\n')}`);
            } catch (error) {
                showResult('analyticsResult', `Error: ${error.message}`, true);
            }
        }

        async function getPaymentStatus() {
            if (!x402Client || !currentPaymentId) {
                showResult('statusResult', 'Error: Please create a payment first', true);
                return;
            }

            showLoading('statusResult');

            try {
                const status = await x402Client.getPaymentStatus(currentPaymentId);

                showResult('statusResult', `‚úÖ Payment Status Retrieved!\n\nPayment ID: ${status.paymentId}\nStatus: ${status.status}\nAmount: $${status.amount}\nService: ${status.service}\nCreated: ${status.createdAt}\nUpdated: ${status.updatedAt}`);
            } catch (error) {
                showResult('statusResult', `Error: ${error.message}`, true);
            }
        }

        // Initialize demo data
        document.addEventListener('DOMContentLoaded', function() {
            // Pre-fill demo data
            document.getElementById('principal').value = '7renf-5svak-mtapl-juxhw-3hv7d-zzfzs-hjlxv-p7wsv-e2zjc-kksxf-3ae';
            document.getElementById('algorandAddress').value = '6W47GCLXWEIEZ2LRQCXF7HGLOYSXYCXOPXJ5YE55EULFHB7O4RWIM3JDCI';
            document.getElementById('metadata').value = '{"demo": true, "timestamp": "' + new Date().toISOString() + '"}';

            // Disable buttons until client is initialized
            document.getElementById('discoverBtn').disabled = true;
            document.getElementById('paymentBtn').disabled = true;
            document.getElementById('aiBtn').disabled = true;
            document.getElementById('analyticsBtn').disabled = true;
            document.getElementById('statusBtn').disabled = true;
        });
    </script>
</body>
</html>